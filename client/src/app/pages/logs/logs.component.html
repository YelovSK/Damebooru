<div class="p-3">
  <h1 class="mb-2 text-3xl font-bold text-accent-primary">Logs</h1>
  <p class="mb-6 text-gray-400">Persisted server logs (database-backed).</p>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
    <app-form-dropdown
      label="Level"
      [options]="levelOptions"
      [value]="level()"
      (valueChange)="onLevelChange($event)">
    </app-form-dropdown>

    <app-search-input
      label="Category"
      [value]="categoryQuery()"
      [debounceMs]="300"
      placeholder="Category contains..."
      (search)="onCategorySearch($event)">
    </app-search-input>

    <app-search-input
      label="Message/Exception"
      [value]="textQuery()"
      [debounceMs]="300"
      placeholder="Message/exception contains..."
      (search)="onTextSearch($event)">
    </app-search-input>
  </div>

  <div class="bg-gray-900 border border-gray-700 rounded-lg p-4 shadow-lg">
    <div class="overflow-x-auto">
      <table class="min-w-[760px] w-full text-left text-gray-300 text-sm">
        <thead>
          <tr class="border-b border-gray-700">
            <th class="py-2 pr-3">Time</th>
            <th class="py-2 pr-3">Level</th>
            <th class="py-2 pr-3">Category</th>
            <th class="py-2">Message</th>
          </tr>
        </thead>
        <tbody>
          @for (entry of logs(); track entry.id) {
            <tr class="border-b border-gray-800 align-top">
              <td class="py-2 pr-3 whitespace-nowrap">{{ entry.timestampUtc | dateTime }}</td>
              <td class="py-2 pr-3">
                <span class="inline-flex rounded border px-2 py-0.5 text-xs font-semibold uppercase tracking-wide"
                  [ngClass]="getLevelClass(entry.level)">
                  {{ entry.level }}
                </span>
              </td>
              <td class="py-2 pr-3 break-all">{{ entry.category }}</td>
              <td class="py-2">
                <div>{{ entry.message }}</div>
                @if (entry.exception) {
                  <pre class="mt-2 whitespace-pre-wrap rounded border border-gray-700 bg-gray-800/40 p-2 text-xs text-red-300">{{ entry.exception }}</pre>
                }
                @if (entry.propertiesJson) {
                  <pre class="mt-2 whitespace-pre-wrap rounded border border-gray-700 bg-gray-800/40 p-2 text-xs text-gray-400">{{ entry.propertiesJson }}</pre>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <div class="mt-4 flex justify-center">
      <app-button variant="secondary" size="sm" (click)="loadMore()" [disabled]="!hasMore()">Load older logs</app-button>
    </div>
  </div>
</div>
