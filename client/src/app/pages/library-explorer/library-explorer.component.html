<section class="space-y-4 p-3">
  <div class="glass-card flex flex-wrap items-center justify-between gap-3 p-4">
    <div class="min-w-0">
      <h1 class="truncate text-2xl font-bold text-accent-primary">Library Explorer</h1>
      @if (browse(); as response) {
      <p class="truncate text-sm text-text-dim">{{ response.libraryName }}</p>
      } @else {
      <p class="text-sm text-text-dim">Loading library...</p>
      }
    </div>

    <a class="inline-flex items-center rounded-md border border-glass-border bg-bg-secondary px-3 py-2 text-sm font-semibold text-text-primary transition-colors hover:border-accent-primary/40 hover:text-accent-primary"
      [routerLink]="['/', appPaths.libraries]">
      Back to Libraries
    </a>
  </div>

  @if (browse(); as response) {
  <div class="glass-card flex flex-wrap items-center justify-between gap-3 p-4">
    <nav class="flex min-w-0 flex-wrap items-center gap-2 text-sm">
      @for (crumb of response.breadcrumbs; track crumb.path) {
      <button type="button" class="rounded border border-glass-border bg-bg-secondary px-2 py-1 text-text-secondary transition-colors hover:border-accent-primary/35 hover:text-accent-primary"
        (click)="onSelectFolder(crumb.path)">
        {{ crumb.name }}
      </button>
      }
    </nav>

    <button type="button"
      class="inline-flex items-center rounded-md border border-glass-border bg-bg-secondary px-3 py-2 text-sm font-semibold text-text-primary transition-colors hover:border-accent-primary/35 hover:text-accent-primary disabled:opacity-40"
      [disabled]="!currentPath()" (click)="onGoUp()">
      Up
    </button>
  </div>
  }

  <section class="glass-card p-3">
    @if (loading()) {
    <div class="rounded-lg border border-glass-border bg-bg-secondary p-4 text-sm text-text-dim">Loading folder...</div>
    } @else if (browse(); as response) {
    <div class="mb-3 flex flex-wrap items-center justify-between gap-2">
      <div class="text-sm text-text-dim">{{ response.childFolders.length | number }} folders</div>
      <div class="text-sm text-text-dim">{{ response.totalCount | number }} posts</div>
    </div>

    @if (response.childFolders.length === 0 && response.posts.length === 0) {
    <div class="rounded-lg border border-glass-border bg-bg-secondary p-8 text-center text-text-dim">
      This folder is empty.
    </div>
    } @else {
    <div class="grid grid-cols-2 gap-3 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8">
      @for (folder of response.childFolders; track folder.path) {
      <button type="button" class="group flex min-h-[124px] flex-col items-center justify-center gap-2 rounded-xl border border-amber-300/20 bg-amber-100/5 p-3 text-center transition-colors hover:border-amber-300/55 hover:bg-amber-100/10"
        (click)="onSelectFolder(folder.path)">
        <div class="inline-flex h-12 w-12 items-center justify-center rounded-lg border border-amber-300/40 bg-amber-400/15 text-amber-100">
          <svg viewBox="0 0 24 24" fill="currentColor" class="h-7 w-7">
            <path d="M10 4l2 2h8a2 2 0 012 2v9a3 3 0 01-3 3H5a3 3 0 01-3-3V7a3 3 0 013-3h5z" />
          </svg>
        </div>
        <div class="line-clamp-2 text-xs font-semibold text-amber-100">{{ folder.name }}</div>
        <div class="text-[0.68rem] text-amber-200/80">{{ folder.recursivePostCount }} posts</div>
      </button>
      }

      @for (post of response.posts; track post.id) {
      <app-post-tile [post]="post"
        [queryParams]="{ explorerLibraryId: response.libraryId, explorerPath: response.currentPath || null }" />
      }
    </div>
    }

    @if (totalPages() > 1) {
    <div class="mt-4">
      <app-paginator [currentPage]="response.page" [totalPages]="totalPages()" (pageChange)="onPageChange($event)" />
    </div>
    }
    } @else {
    <div class="rounded-lg border border-glass-border bg-bg-secondary p-4 text-sm text-status-error">
      Explorer data unavailable.
    </div>
    }
  </section>
</section>
