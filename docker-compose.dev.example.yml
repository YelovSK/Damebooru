services:
  server:
    build:
      context: ./server
    image: damebooru-server:dev
    restart: unless-stopped
    environment:
      ASPNETCORE_URLS: "http://+:${SERVER_PORT:-6666}"
      Damebooru__Storage__DatabasePath: /app/data/damebooru.db
      Damebooru__Storage__ThumbnailPath: /app/data/thumbnails
      Damebooru__Storage__TempPath: /app/data/temp
      Damebooru__Auth__Enabled: "${AUTH_ENABLED:-true}"
      Damebooru__Auth__Username: "${AUTH_USERNAME:-admin}"
      Damebooru__Auth__Password: "${AUTH_PASSWORD:-change-me}"
    volumes:
      - ./data/server:/app/data
      - ${MEDIA_PATH:-./media}:/media

  client:
    build:
      context: ./client
    image: damebooru-client:dev
    restart: unless-stopped
    depends_on:
      - server
    environment:
      BACKEND_HOST: server
      BACKEND_PORT: "${SERVER_PORT:-6666}"
    ports:
      - "${CLIENT_PORT:-8080}:80"
